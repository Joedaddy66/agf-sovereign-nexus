name: ðŸš€ Deploy to Azure Production

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

env: 
  AZURE_SUBSCRIPTION_ID: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
  RESOURCE_GROUP: rg-lazarus-omega-production
  LOCATION: eastus2
  ACR_NAME: acrlazarusomega14916273309420
  CONTAINER_APP_NAME: ca-lazarus-omega-brief

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Azure Login
        uses: azure/login@v1
        with: 
          creds: ${{ secrets.AZURE_CREDENTIALS }}
      
      - name: Create Resource Group
        run: |
          az group create \
            --name ${{ env.RESOURCE_GROUP }} \
            --location ${{ env.LOCATION }}
      
      - name: Deploy Infrastructure
        uses: azure/arm-deploy@v1
        with:
          subscriptionId: ${{ env.AZURE_SUBSCRIPTION_ID }}
          resourceGroupName: ${{ env.RESOURCE_GROUP }}
          template: ./deployment/main.bicep
          parameters: ./deployment/parameters.production.json
          deploymentName: lazarus-omega-${{ github.sha }}
      
      - name: Deployment Complete
        run: echo "âœ… Deployment successful"
